# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Архитектура проекта:


В проекте реализуется архитектура потока данных **MVС**(Model, View, Controller).
Бизнес-логика — решение, как и что поменять в данных, реагируя на действия пользователя, — находится в контроллере, а модель отвечает только за хранение и преобразование форматов данных.
<img width="1440" alt="PRODPP-8302-1_1715774864" src="https://github.com/user-attachments/assets/568f3fcb-404f-4c97-94fc-474c473d461a">

MVC-паттерн делит код на три слоя:

- **Model** (Слой данных) — данные, в которых отражена вся ценность приложения. Этот слой содержит значительную часть бизнес-логики. При изменении данные должны попадать в отображение.
Его представляет абстрактный класс `Model<T>` и реализующий его `Order`, `Catalog` и `BasketModelr`, отвещающий за хранение ключевых данных o всех товарах и о заказе, необходимые для взаимодействия с сервером и осуществеления бизнес логики.

- **View** (Слой отображения) — интерфейс для взаимодействия с пользователем. Его задача — выводить что-то на экран и генерировать события с действиями пользователя. Никаких решений тут не принимается.
Его представляет абстрактный класс `Component<T>`, который реализуется в нескольких классах - `Page`, `Modal`, `Card<T>`, `Form<T>`, `Basket`, `Success`. Классы осуществляют создание визуального образа приложения в виде различных компонентов и обработку пользовательских событий.

- **Controller** (Слой управления) — слушает события в пользовательском интерфейсе и принимает решение:
1. что с ними делать;
2. в какую модель отнести, чтобы она среагировала и поменялась.

### Схема с архитектурой проекта:
![MVC WEB-LAREK(1 0) drawio](https://github.com/user-attachments/assets/b9fbe5d8-9fea-4cbb-a6bc-8a187ad2abc2)

## Базовый код
### 1. Класс `Component<T>`
Абстрактный базовый класс, предназначенным для создания компонентов пользовательского интерфейса. Класс обеспечивает инструментарий для управления DOM элементами и поведением компонента. Наследуется всеми классами представления(View)

**`constructor`** - принимает DOM-элемент контейнера, в который будет помещен компонент.

**Методы:**
  - `toggleClass` - переключается класс для переданного элемента.
  - `setText` - устанавливает текстовое содержимое для переданного элемента.
  - `setImage` - устанавливает изображения и альтернативный текст для изоображения(опционально) для переданного элемента типа HTMLImageElement
  - `setDisabled` - изменяет статус блокировки для переданного элемента.
  - `setHidden`, `setVisible` - скрывает,отоброжает переданный элемент.
  - `render` - рендерит корневой DOM-элемент, используя переданные данные. Метод должен быть переназначен в дочерних классах.

### 2. Класс `Model<T>`
Абстрактный базовый класс, предназначенный для создания модельных данных. Модели используются для представления и управления данными в приложении.

**`constructor`** - принимает начальный данные для модели и объект событий для уведомления о изменениях в модели.

**Методы:**

  - `emitChanges` - инициирует событие с переданным названием и данными, уведомляя подписчиков в изменении модели

### 3. Класс `Api`
Базовый класс для работы с API, реализует методы для выполнения HTTP-запросов к переданному базовуму URL.

**`constructor`** - принимает базовый URL и глобальные опции для всех запросов(опционально).

**Поля:**

- `baseUrl: string` - базовый URL для запросов
- `options: RequestInit` - объект опций для запросов

**Методы:**

  - `handleResponse` - отрабатывает ответы от сервера, преобразуя их в json и управляя ошибками.
  - `get` - выполняет GET запросы к предоставленному URL, ответ запроса обрабатывается при помощи метода `handleResponse` и возвращается `Promise`
  - `post` - выполняет запрос к API с использованием предоставленного метода(POST|PUT|DELETE) и предоставленными данными.

### 4. Класс `EventEmmiter`
Базовый класс реализующий функции брокера событий.

**`constructor`** - инициализирует объект.

**Поля:**

- `_events: Map<EventName, Set<Subscriber>>` - приватное свойство, содержащее карту "вид события - набор подписчиков"

**Методы:**

  - `on`, `off`, `emmit` - подписывают, снимают подписку и инициируют событие соответственно.
  - `onAll`, `ofAll` - подписывает на все события и сбрасывает все обработчики событий соответсвенно.
  - `trigger` - генерирует заданной событие с заданными аргументами. Позволяет передавать его в качестве обработчика события в другие классы, не зависящии напрямую от класса `EventEmmiter`.

**Типы и интерфейсы**

- `type EventName` - типизация имени события строкой или регулярным выражением
- `type Subscriber` - типизация функции-подписчика на событие
- `type EmitterEvent` - типизация события эмиттера с именем и данными
- `interface IEvents` - интерфейс, необходимый для реализации принципа инверсии зависимостей

## Котроллер Событий (Controller)

Модели данных и отображения связаны при помощи `EventEmitter`. Мы подписываемся на различные события: клик по карточке, переход в корзину и т.д. Виды событий и подписчики инициализируются при описании или инстанцировании классов. `EventEmitter` позволяет менять отображение при изменении данных в модели.

## Компоненты модели данных(бизнес-логика)

### 1. Класс `Catalog` (Модель каталога товаров)
Наследует абстрактный класс Model, на место дженерика передается массив объектов, реализующих интерфейс `IProduct`. Хранит данные о всех товарах.

**Поля:**

- `products: IProduct[]` - публичное свойство, хранящее массив товаров

**Методы:**

- `setProducts` - публичный метод, позволяющий из переданных данных создать инстансы класса `Product` и сохранить в свойство `products`. Также уведомляет подписчиков об изменении модели родительским методом `emitChanges`.

### 2. Класс `BasketModel` (Модель корзины)
Наследует абстрактный класс Model, на место дженерика передается массив объектов, реализующих интерфейс `IBasket`. Хранит данные о добавленных пользователем в корзину товарах: их список и итоговую сумму к оплате.

**Поля:**

- `total: number | null` - публичное свойство, хранящее сумму к оплате
- `products: IProduct[]` - публичное свойство, хранящее массив товаров

**Методы:**

- `addToBasket` - метод, добавляющий товар в корзину
- `removeFromBasket` - удаляет товар из корзины
- `clearBasket` - очищает корзину
- `getTotalBasketPrice` - позволяет получить суммарную стоимость товаров в корзине

### 3. Класс `Order` (Модель данных заказа)

Наследует абстрактный класс Model, на место дженерика передается массив объектов, реализующих интерфейс `IOrder`. Хранит все необходимые данные о заказе (см. поля класса), часть которых будет сетаться из модели корзины, часть - вводиться пользователем.

**Поля**

- `items: string[]` - хранит массив айдишников выбранных товаров
- `total: number | null` - хранит сумму заказа
- `payment: PaymentMethods` - хранит способ оплаты
- `address: string` - хранит адрес доставки
- `email: string` - хранит почту пользователя
- `phone: string` - хранит телефон пользователя
- `valid: boolean` - хранит информацию о валидности введенных пользователем данных
- `errors: Partial<Record<keyof IOrder, string>>` - хранит ошибки валидации форм

**Методы**

- `validateContacts()` и `validateDeliveryDetails()` - методы валидации введенных пользователем данных. Эти методы проверяют данные и добавляют события изменения состояния валидации.
- `removeOrderData()` - метод для сброса всех данных заказа

## Компоненты представления (View)

### 1. Класс `Card`

Наследует абстрактный класс `Component`, в качестве дженерика передается интерфейс `IProduct`. Это класс отображения карточки. Было решено сделать один класс, содержащий все поля карточки, а потом сетать его в разные темплейты (отображение в каталоге, отображение на превью)

**`constructor`**

В качестве аргументов принимает название блока (чтобы сформировать селектор для поиска элементов по DOM-дереву), контейнер для поиска и опционально объект действий. В конструкторе инициализируются защищенные поля класса с проверкой на наличие элементов в DOM-дереве. Также добавляются слушатели на клики.

**Поля:**

- `# _title: HTMLElement` - DOM-элемент для отображения названия товара
- `# _category: HTMLElement` - DOM-элемент для отображения категории товара
- `# _image: HTMLImageElement` - DOM-элемент для отображения картинки
- `# _price: HTMLElement` - DOM-элемент для отображения цены
- `# _description: HTMLElement` - DOM-элемент для отображения описания товара
- `# _button: HTMLButtonElement` - DOM-элемент для отображения кнопки "В коризну"
- `# _basketIndex: HTMLElement` - DOM-элемент для отображения индекса карточки, находящейся в корзине
- `# _deleteFromBasketButton: HTMLButtonElement` - DOM-элемент для отображения иконки удаления товара из корзины
- `+ switchButtonText` - метод для смены текста кнопки после добавления/удаления товара из корзины

**Методы:**

- `set id` и `get id` - позволяют установить и получить id товара
- `set title` и `get title` - позволяют установить и получить название товара
- `set image` - позволяет установить изображение товара
- `set price` - позволяет установить цену товара; также форматирует цену, чтобы числа выглядели, как в макете, при помощи функции `handlePrice()`. В этом сеттере дополнительно реализована блокировка кнопки добавления в корзину для бесценного товара.
- `set category` - позволяет установить категорию товара; также добавляет DOM-элементу селектор соответствующей категории, чтобы отобразить цвет тега
- `set description` - устанавливает описание товара
- `set basketIndex` - устанавливает номер по порядку для товаров в корзине

### 2. Класс `Form`

Наследует абстрактный класс `Component`, в качестве дженерика передается интерфейс `IFormState`. Это класс отображения формы. В проекте будут две формы: форма с деталями для оформления доставки и форма с контактами пользователя.

**`constructor`**

В качестве аргументов принимает контейнер для поиска и объект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также добавляется слушатели на сабмит и инпут формы.

**Поля:**

- `# _submit: HTMLButtonElement` - DOM-элемент кнопки отправки данных формы
- `# _errors: HTMLElement` - DOM-элемент, в котором будут отображаться ошибки валидации

**Методы:**

- `onInputChange` - защищенный метод для события введения данных пользователем
- `set valid` - деактивирует кнопку сабмита, если данные в форме валидны
- `set errors` - добавляет ошибки валидации
- `render` - отрисовка формы

### 3. Класс `DeliveryDetails`

Наследует абстрактный класс `Form`, в качестве дженерика передается интерфейс `IDeliveryDetails`. Это класс отображения формы о деталях доставки: адрес и способ оплаты.

**`constructor`**

В качестве аргументов принимает контейнер для поиска и объект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также добавляются слушатели на кнопки выбора способа оплаты и инпут адреса.

**Поля:**

- `# _card: HTMLButtonElement` - кнопка для выбора способа оплаты: онлайн
- `# _cash: HTMLButtonElement` - кнопка для выбора способа оплаты: при получении
- `# _address: HTMLInputElement` - поле ввода адреса

**Методы:**

- `set address(value: string)` - сеттер для адреса
- `set payment(value: PaymentMethods)` - сеттер для способа оплаты

### 4. Класс `Contacts`

Наследует абстрактный класс `Form`, в качестве дженерика передается интерфейс `IContacts`. Это класс отображения формы о контактах пользователя: почта и телефон.

**`constructor`**

В качестве аргументов принимает контейнер для поиска и объект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также добавляются слушатели инпуты.

**Поля:**

- `# _email: HTMLInputElement` - DOM-элемент инпута почты
- `# _phone: HTMLInputElement` - DOM-элемент инпута телефона

**Методы:**

- `set email` - сеттер для почты
- `set phone` - сеттер для телефона

### 5. Класс `Page`

Наследует абстрактный класс `Component`, в качестве дженерика передается интерфейс `IPage`. Это класс отображения всей страницы, содержащей хедер с логотипом и корзиной, а также каталог товаров.

**`constructor`**

В конструкторе инициализируются защищенные поля класса с проверкой на наличие элементов в DOM-дереве. Также добавляется слушатель на клик по корзине.

**Поля:**

- `# _counter: HTMLElement` - DOM-элемент, в котором будет отображаться количество товаров в корзине
- `# _catalog: HTMLElement` - DOM-элемент для отображения каталога товаров
- `# _wrapper: HTMLElement` - DOM-элемент, являющийся оболочкой страницы; необходим, чтобы заблокировать прокрутку страницы
- `# _basket: HTMLElement` - DOM-элемент для отображения корзины

**Методы:**

- `set counter` - устанавливает количество товаров в корзине
- `set catalog` - устанавливает товары в каталог
- `set locked` - позволяет заблокировать страницу для прокрутки

### 6. Класс `Modal`

Наследует абстрактный класс `Component`, в качестве дженерика передается интерфейс `IModalData`. Это класс отображения модального окна. В него будет сетаться различный контент: карточка товара, корзина, окно успешного оформления и т.д.

**`constructor`**

В качестве аргументов принимает контейнер для поиска и обект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также доабвляются слушатели на клики.

**Поля:**

- `# _closeButton: HTMLButtonElement` - DOM-элемент кнопки закрытия модального окна
- `# _content: HTMLElement` - DOM-элемент для отображения контента

**Методы:**

- `set content` - сеттер для установки контента в модалку
- `open` - метод для открытия модалки
- `close` - для закрытия модалки
- `render` - для отрисовки модалки

### 7. Класс `Basket`

Наследует абстрактный класс `Component`, в качестве дженерика передается интерфейс `IBasket`. Это класс отображения корзины. Корзина будет рендериться в модальном окне. В свою очередь, в корзине будут рендериться карточки выбранных товаров.

**`constructor`**

В качестве аргументов принимает название блока, контейнер для поиска и обект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также добавляется слушатель на клик по кнопке офорления заказа.

**Поля:**

- `# _list: HTMLElement` - DOM-элемент для отображения списка товаров
- `# _total: HTMLElement` - DOM-элемент для отображения итоговой суммы корзины
- `# _button: HTMLButtonElement` - DOM-элемент для отображения кнопки "Оформить"

**Методы:**

- `set total` - сеттер для установки стоимости товаров в корзине
- `set items` - для установки отображаемых в корзине товаров; здесь же в зависимости от наличия товаров в корзине активируется/деактивируется кнопка оформления заказа

### 8. Класс `Success`

Наследует абстрактный класс `Component`, в качестве дженерика передается интерфейс `ISuccess`. Это класс отображения окошка об успешной оплаты. В проекте не внедрена платежная система, поэтому для отображения этого экрана необходимо кликнуть на сабмит последней формы. При этом данные о заказе отправятся на сервер.

**`constructor`**

В качестве аргументов принимает имя блока, контейнер для поиска и объект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также добавляется слушатель на кнопку.

**Поля**

- `# _button: HTMLButtonElement` - кнопка "За новыми покупками", при клике на которую окошко закрывается
- `# _description: HTMLElement` - DOM-элемент, куда вписывается итоговая сумма заказа

**Методы:**

- `set total` - сеттер для отображения итоговой суммы

### Представленные `типы` и `интерфейсы`:

- `interface ICardActions` - типизирует действия с карточкой методом `onClick`
- `interface IFormState` - интерфейс состояния формы, включающий флаг о валидности данных и объект ошибок валидации
- `interface IDeliveryDetails` - интерфейс данных о способе оплаты и адресе, необходимый для рендера формы
- `interface IContacts` - интерфейс данных о контактах юзера, неоюходимый для рендера формы
- `interface IPage` - содержит те публичные свойства класса, которые можно установить сеттерами
- `interface IModalData` - интерфейс, описывающий структуру данных, которые необходимо передать модалке для отрисовки
- `interface IBasket` - интерфейс, описывающий структуру данных, необходимых для отрисовки корзины
- `interface ISuccess` - интерфейс данных успешного оформления заказа. Содержит итоговую сумму заказа и необходим для рендера
- `interface ISuccessActions` - интерфейс, описывающий действия с окошком
- `interface ApiResponse` - интерфейс, обращения к серверу
- `interface IEvents` - интерфейс, общих методов события
- `interface IFormValidation` - интерфейс, реализующий валидацию форм
  
- `type ApiListResponse` - данные ответа от сервера
- `type ApiPostMethods` - методы запросов к серверу ('POST' | 'PUT' | 'DELETE')
- `type EventName` - название события
- `type Subscriber` - подписчик на событие, представленный в виде функции
- `type EmitterEvent` - представляет собой структуру объекта события, включающего имя события и данные, связанные с событием
- `type CategoryType` - варианты категорий товаров
- `type PaymentMethods` - возможные способы оплаты (онлайн/офлайн)


