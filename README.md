# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура проекта:

В проекте было решено реализовать архитектуру **MVС**(Model, View, Controller).

###

Бизнес-логика — решение, как и что поменять в данных, реагируя на действия пользователя, — находится в контроллере, а модель отвечает только за хранение и преобразование форматов данных. Для работы модели с данными, мы напрямую будем получать данные с сервера через блок **DATA**, который будет включать в себя соеденительный интерфейс `ApiResponse` класса `Api`.

###

<img width="1440" alt="PRODPP-8302-1_1715774864" src="https://github.com/user-attachments/assets/568f3fcb-404f-4c97-94fc-474c473d461a">

MVC-паттерн делит код на три слоя:

- **Model** (Слой данных) — данные, в которых отражена вся ценность приложения. Этот слой содержит значительную часть бизнес-логики. При изменении данные должны попадать в отображение.
  Его представляет абстрактный класс `Model<T>` и реализующий его `Order`, `Catalog` и `BasketModelr`, отвещающий за хранение ключевых данных o всех товарах и о заказе, необходимые для взаимодействия с сервером и осуществеления бизнес логики.

- **View** (Слой отображения) — интерфейс для взаимодействия с пользователем. Его задача — выводить что-то на экран и генерировать события с действиями пользователя. Никаких решений тут не принимается.
  Его представляет абстрактный класс `Component<T>`, который реализуется в нескольких классах - `AppPage`, `ModalWindow`, `ProductCard`, `Form<T>`, `ShoppingCartView`, `SuccessMessage`. Классы осуществляют создание визуального образа приложения в виде различных компонентов и обработку пользовательских событий.

- **Controller** (Слой управления)
  — Представлен классом `AppEventEmitter`, который отслеживает изменения состояния приложения (события), вносит изменения в данные Модели и оповещает о них необходимые компоненты приложения, которые меняются в соответствии с произошедшим событием.
  Слушает события в пользовательском интерфейсе и принимает решение:

1. что с ними делать;
2. в какую модель отнести, чтобы она среагировала и поменялась.

### Схема с архитектурой проекта:

###

![MVC WEB-LAREK drawio](https://github.com/user-attachments/assets/a584be68-26e8-4467-a4ba-f911c17a9372)


## Базовый код

### 1. Класс `Component<T>`

Абстрактный базовый класс, предназначенным для создания компонентов пользовательского интерфейса. Класс обеспечивает инструментарий для управления DOM элементами и поведением компонента. Наследуется всеми классами представления(View)

**`constructor`** - принимает DOM-элемент контейнера, в который будет помещен компонент.

**Методы:**

- `toggleClass` - переключается класс для переданного элемента.
- `setText` - устанавливает текстовое содержимое для переданного элемента.
- `setImage` - устанавливает изображения и альтернативный текст для изоображения(опционально) для переданного элемента типа HTMLImageElement
- `setDisabled` - изменяет статус блокировки для переданного элемента.
- `setHidden`, `setVisible` - скрывает,отоброжает переданный элемент.
- `renderContent` - рендерит корневой DOM-элемент, используя переданные данные. Метод должен быть переназначен в дочерних классах.

### 2. Класс `Model<T>`

Абстрактный базовый класс, предназначенный для создания модельных данных. Модели используются для представления и управления данными в приложении.

**`constructor`** - принимает начальный данные для модели и объект событий для уведомления о изменениях в модели.

**Методы:**

- `emitChanges` - инициирует событие с переданным названием и данными, уведомляя подписчиков в изменении модели

### 3. Класс `ApiService`

Базовый класс для работы с API, реализует методы для выполнения HTTP-запросов к переданному базовуму URL.

**`constructor`** - принимает базовый URL и глобальные опции для всех запросов(опционально).

**Поля:**

- `baseUrl: string` - базовый URL для запросов
- `options: RequestInit` - объект опций для запросов

**Методы:**

- `handleResponse` - отрабатывает ответы от сервера, преобразуя их в json и управляя ошибками.
- `get` - выполняет GET запросы к предоставленному URL, ответ запроса обрабатывается при помощи метода `handleResponse` и возвращается `Promise`
- `post` - выполняет запрос к API с использованием предоставленного метода(POST|PUT|DELETE) и предоставленными данными.

### 4. Класс `AppEventEmitter`

Базовый класс, являющийся контроллером и реализующий функции брокера событий через имплементируемый интерфейс `IEvents`.

**`constructor`** - инициализирует объект.

**Поля:**

- `_events: Map<EventName, Set<Subscriber>>` - приватное свойство, содержащее карту "вид события - набор подписчиков"

**Методы:**

- `on`, `off`, `emmit` - подписывают, снимают подписку и инициируют событие соответственно.
- `onAll`, `ofAll` - подписывает на все события и сбрасывает все обработчики событий соответсвенно.
- `trigger` - генерирует заданной событие с заданными аргументами. Позволяет передавать его в качестве обработчика события в другие классы, не зависящии напрямую от класса `AppEventEmitter`.

**Типы и интерфейсы**

- `type EventName` - типизация имени события строкой или регулярным выражением
- `type Subscriber` - типизация функции-подписчика на событие
- `type EmitterEvent` - типизация события эмиттера с именем и данными
- `interface IEvents` - интерфейс, необходимый для реализации принципа инверсии зависимостей

## Котроллер (Controller)

Модели данных и отображения связаны при помощи `AppEventEmitter`. Мы подписываемся на различные события: клик по карточке, переход в корзину и т.д. Виды событий и подписчики инициализируются при описании или инстанцировании классов. `AppEventEmitter` позволяет менять отображение при изменении данных в модели.

## Компоненты модели данных(бизнес-логика)

### 1. Класс `ProductCatalog` (Модель каталога товаров)

Наследует абстрактный класс Model, на место дженерика передается массив объектов, реализующих интерфейс `IProductInfo`. Хранит данные о всех товарах.

**Поля:**

- `products: IProductInfo[]` - публичное свойство, хранящее массив товаров

**Методы:**

- `setProductList` - публичный метод, позволяющий из переданных данных создать инстансы и сохранить их в свойство `products`. Также уведомляет подписчиков об изменении модели родительским методом `emitChanges`.

- `resetProductSelection` - Этот метод сбрасывает выбор товаров в каталоге, убирая флаги `inBasket` у всех товаров.

### 2. Класс `ShoppingCart` (Модель корзины)

Наследует абстрактный класс Model, на место дженерика передается массив объектов, реализующих интерфейс `IBasket`. Хранит данные о добавленных пользователем в корзину товарах: их список и итоговую сумму к оплате.

**Поля:**

- `total: number | null` - публичное свойство, хранящее сумму к оплате
- `products: IProductInfo[]` - публичное свойство, хранящее массив товаров

**Методы:**

- `addProduct` - метод, добавляющий товар в корзину
- `removeProduct` - удаляет товар из корзины
- `clearCart` - очищает корзину
- `getTotalBasketPrice` - позволяет получить суммарную стоимость товаров в корзине

### 3. Класс `OrderModel` (Модель данных заказа)

Наследует абстрактный класс Model, на место дженерика передается массив объектов, реализующих интерфейс `IOrderDetails`. Хранит все необходимые данные о заказе (см. поля класса), часть которых будет сетаться из модели корзины, часть - вводиться пользователем.

**Поля**

- `items: string[]` - хранит массив айдишников выбранных товаров
- `total: number | null` - хранит сумму заказа
- `payment: PaymentMethods` - хранит способ оплаты
- `address: string` - хранит адрес доставки
- `email: string` - хранит почту пользователя
- `phone: string` - хранит телефон пользователя
- `isValid: boolean` - хранит информацию о валидности введенных пользователем данных
- `errorMessages: Partial<Record<keyof IOrderDetails, string>>` - хранит ошибки валидации форм

**Методы**

- `validateContactDetails()` и `validateDeliveryDetails()` - методы валидации введенных пользователем данных. Эти методы проверяют данные и добавляют события изменения состояния валидации.
- `clearOrderData()` - метод для сброса всех данных заказа

## Компоненты представления (View)

### 1. Класс `ProductCard`

Наследует абстрактный класс `Component`, в качестве дженерика передается интерфейс `IProductInfo`. Это класс отображения карточки. Было решено сделать один класс, содержащий все поля карточки, а потом сетать его в разные темплейты (отображение в каталоге, отображение на превью)

**`constructor`**

В качестве аргументов принимает название блока (чтобы сформировать селектор для поиска элементов по DOM-дереву), контейнер для поиска и опционально объект действий. В конструкторе инициализируются защищенные поля класса с проверкой на наличие элементов в DOM-дереве. Также добавляются слушатели на клики.

**Поля:**

- `# _title: HTMLElement` - DOM-элемент для отображения названия товара
- `# _category: HTMLElement` - DOM-элемент для отображения категории товара
- `# _image: HTMLImageElement` - DOM-элемент для отображения картинки
- `# _price: HTMLElement` - DOM-элемент для отображения цены
- `# _description: HTMLElement` - DOM-элемент для отображения описания товара
- `# _button: HTMLButtonElement` - DOM-элемент для отображения кнопки "В коризну"
- `# _displayIndex: HTMLElement` - DOM-элемент для отображения индекса карточки, находящейся в корзине
- `# _deleteFromBasketButton: HTMLButtonElement` - DOM-элемент для отображения иконки удаления товара из корзины

**Методы:**

- `set id` и `get id` - позволяют установить и получить id товара
- `set title` и `get title` - позволяют установить и получить название товара
- `set image` - позволяет установить изображение товара
- `set price` - позволяет установить цену товара; также форматирует цену, чтобы числа выглядели, как в макете, при помощи функции `handlePrice()`. В этом сеттере дополнительно реализована блокировка кнопки добавления в корзину для бесценного товара.
- `set category` - позволяет установить категорию товара; также добавляет DOM-элементу селектор соответствующей категории, чтобы отобразить цвет тега
- `set description` - устанавливает описание товара
- `set displayIndex` - устанавливает номер по порядку для товаров в корзине
- `updateButtonLabel` - обновляет названия кнопок для добавления и удаления товара в корзину.

### 2. Класс `Form<T>`

Наследует абстрактный класс `Component`, в качестве дженерика передается интерфейс `IFormState`. Это класс отображения формы. В проекте будут две формы: форма с деталями для оформления доставки и форма с контактами пользователя.

**`constructor`**

В качестве аргументов принимает контейнер для поиска и объект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также добавляется слушатели на сабмит и инпут формы.

**Поля:**

- `# _submit: HTMLButtonElement` - DOM-элемент кнопки отправки данных формы
- `# _errors: HTMLElement` - DOM-элемент, в котором будут отображаться ошибки валидации

**Методы:**

- `onInputChange` - защищенный метод для события введения данных пользователем
- `set isValid` - деактивирует кнопку сабмита, если данные в форме валидны
- `set errorMessages` - добавляет ошибки валидации
- `renderContent` - отрисовка формы

### 3. Класс `DeliveryForm`

Наследует абстрактный класс `Form`, в качестве дженерика передается интерфейс `IDeliveryDetails`. Это класс отображения формы о деталях доставки: адрес и способ оплаты.

**`constructor`**

В качестве аргументов принимает контейнер для поиска и объект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также добавляются слушатели на кнопки выбора способа оплаты и инпут адреса.

**Поля:**

- `# _card: HTMLButtonElement` - кнопка для выбора способа оплаты: онлайн
- `# _cash: HTMLButtonElement` - кнопка для выбора способа оплаты: при получении
- `# _address: HTMLInputElement` - поле ввода адреса

**Методы:**

- `set address(value: string)` - сеттер для адреса
- `set paymentMethod(value: PaymentMethods)` - сеттер для способа оплаты

### 4. Класс `ContactForm`

Наследует абстрактный класс `Form`, в качестве дженерика передается интерфейс `IContacts`. Это класс отображения формы о контактах пользователя: почта и телефон.

**`constructor`**

В качестве аргументов принимает контейнер для поиска и объект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также добавляются слушатели инпуты.

**Поля:**

- `# _email: HTMLInputElement` - DOM-элемент инпута почты
- `# _phone: HTMLInputElement` - DOM-элемент инпута телефона

**Методы:**

- `set email` - сеттер для почты
- `set phone` - сеттер для телефона

### 5. Класс `AppPage`

Наследует абстрактный класс `Component`, в качестве дженерика передается интерфейс `IPage`. Это класс отображения всей страницы, содержащей хедер с логотипом и корзиной, а также каталог товаров.

**`constructor`**

В конструкторе инициализируются защищенные поля класса с проверкой на наличие элементов в DOM-дереве. Также добавляется слушатель на клик по корзине.

**Поля:**

- `# _cartItemCount: HTMLElement` - DOM-элемент, в котором будет отображаться количество товаров в корзине
- `# _catalog: HTMLElement` - DOM-элемент для отображения каталога товаров
- `# _wrapper: HTMLElement` - DOM-элемент, являющийся оболочкой страницы; необходим, чтобы заблокировать прокрутку страницы
- `# _basket: HTMLElement` - DOM-элемент для отображения корзины

**Методы:**

- `set cartItemCount` - устанавливает количество товаров в корзине
- `set catalog` - устанавливает товары в каталог
- `set isScrollLocked` - позволяет заблокировать страницу для прокрутки

### 6. Класс `ModalWindow`

Наследует абстрактный класс `Component`, в качестве дженерика передается интерфейс `IModalData`. Это класс отображения модального окна. В него будет сетаться различный контент: карточка товара, корзина, окно успешного оформления и т.д.

**`constructor`**

В качестве аргументов принимает контейнер для поиска и обект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также доабвляются слушатели на клики.

**Поля:**

- `# _closeButton: HTMLButtonElement` - DOM-элемент кнопки закрытия модального окна
- `# _content: HTMLElement` - DOM-элемент для отображения контента

**Методы:**

- `set content` - сеттер для установки контента в модалку
- `open` - метод для открытия модалки
- `close` - для закрытия модалки
- `renderContent` - для отрисовки модалки

### 7. Класс `ShoppingCartView`

Наследует абстрактный класс `Component`, в качестве дженерика передается интерфейс `IBasket`. Это класс отображения корзины. Корзина будет рендериться в модальном окне. В свою очередь, в корзине будут рендериться карточки выбранных товаров.

**`constructor`**

В качестве аргументов принимает название блока, контейнер для поиска и обект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также добавляется слушатель на клик по кнопке офорления заказа.

**Поля:**

- `# _list: HTMLElement` - DOM-элемент для отображения списка товаров
- `# _total: HTMLElement` - DOM-элемент для отображения итоговой суммы корзины
- `# _button: HTMLButtonElement` - DOM-элемент для отображения кнопки "Оформить"

**Методы:**

- `set total` - сеттер для установки стоимости товаров в корзине
- `set items` - для установки отображаемых в корзине товаров; здесь же в зависимости от наличия товаров в корзине активируется/деактивируется кнопка оформления заказа

### 8. Класс `SuccessMessage`

Наследует абстрактный класс `Component`, в качестве дженерика передается интерфейс `ISuccess`. Это класс отображения окошка об успешной оплаты. В проекте не внедрена платежная система, поэтому для отображения этого экрана необходимо кликнуть на сабмит последней формы. При этом данные о заказе отправятся на сервер.

**`constructor`**

В качестве аргументов принимает имя блока, контейнер для поиска и объект для работы с событиями. В конструкторе инициализируются защищенные свойства, а также добавляется слушатель на кнопку.

**Поля**

- `# _button: HTMLButtonElement` - кнопка "За новыми покупками", при клике на которую окошко закрывается
- `# _description: HTMLElement` - DOM-элемент, куда вписывается итоговая сумма заказа

**Методы:**

- `set total` - сеттер для отображения итоговой суммы

## Представленные `типы` и `интерфейсы`:

- `interface ICardActions` - типизирует действия с карточкой методом `onClick`
- `interface IFormState` - интерфейс состояния формы, включающий флаг о валидности данных и объект ошибок валидации
- `interface IDeliveryDetails` - интерфейс данных о способе оплаты и адресе, необходимый для рендера формы
- `interface IContacts` - интерфейс данных о контактах юзера, неоюходимый для рендера формы
- `interface IPage` - содержит те публичные свойства класса, которые можно установить сеттерами
- `interface IModalData` - интерфейс, описывающий структуру данных, которые необходимо передать модалке для отрисовки
- `interface IBasket` - интерфейс, описывающий структуру данных, необходимых для отрисовки корзины
- `interface ISuccess` - интерфейс данных успешного оформления заказа. Содержит итоговую сумму заказа и необходим для рендера
- `interface ISuccessActions` - интерфейс, описывающий действия с окошком
- `interface ApiResponse` - интерфейс, обращения к серверу
- `interface IEvents` - интерфейс, общих методов события
- `interface IFormValidation` - интерфейс, реализующий валидацию форм

- `interface IProductInfo` - описывает структуру объекта, представляющего товар в системе. Он включает ключевые свойства, необходимые для отображения информации о товаре, работы с корзиной и управления данными каталога.
- `type ApiListResponse` - данные ответа от сервера
- `type ApiPostMethods` - методы запросов к серверу ('POST' | 'PUT' | 'DELETE')
- `type EventName` - название события
- `type Subscriber` - подписчик на событие, представленный в виде функции
- `type EmitterEvent` - представляет собой структуру объекта события, включающего имя события и данные, связанные с событием
- `type CategoryType` - варианты категорий товаров
- `type PaymentOptions` - возможные способы оплаты (онлайн/офлайн)
- `type IOrderDetails` - это комплексный тип для данных заказа. Он объединяет: товары в корзине, информацию о доставке, контактные данные пользователя, состояние валидации формы.

## Итоговый вид проектной работы:

![present1](https://github.com/user-attachments/assets/9f9bac7d-3a95-434a-9d2e-fd8e1d15f14a)
![present2](https://github.com/user-attachments/assets/7956dd7b-6fc2-45cf-8972-e8aff4386c9b)
![present3](https://github.com/user-attachments/assets/60346821-d9b1-456c-8cc0-ed58f162bec0)
![present4](https://github.com/user-attachments/assets/e06cb4cd-7d92-4eef-98e0-1299d5818f4a)
![present5](https://github.com/user-attachments/assets/22469570-04dc-4343-885c-0fc31ba181a8)
![present6](https://github.com/user-attachments/assets/320cd9a6-bc84-441f-b58e-c78c93e97a22)
